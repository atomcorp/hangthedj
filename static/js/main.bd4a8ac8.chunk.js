(this.webpackJsonphangthedj=this.webpackJsonphangthedj||[]).push([[0],[,,,,,function(e,t,a){e.exports={choice:"InPlay_choice__1reU5",prompt:"InPlay_prompt__1g_cl"}},,function(e,t,a){e.exports={header:"App_header__3BlUL",toolbar:"App_toolbar__1jzI0"}},,,function(e,t,a){e.exports={addnew:"Start_addnew__2_Mwf"}},function(e,t,a){e.exports=a(17)},,,,,function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(9),c=a.n(l),i=(a(16),a(1)),o=a(2),s=a(4),u=function(e){return r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Player"),r.a.createElement("th",null,"Score"))),r.a.createElement("tbody",null,Object(s.a)(e.players).sort((function(e,t){return e.score<t.score?1:-1})).map((function(e,t){return r.a.createElement("tr",{key:t},r.a.createElement("td",null,e.avatar," ",e.name),r.a.createElement("td",null,e.score))}))))},d=["\ud83d\udc35","\ud83d\udc36","\ud83e\udd8a","\ud83e\udd9d","\ud83d\udc34","\ud83e\udd93","\ud83d\udc37","\ud83d\udc17","\ud83e\udd92","\ud83d\udc2d","\ud83d\udc39","\ud83d\udc38","\ud83d\udc2c"],m=function(){var e=d;return{get:function(){var t=Math.floor(Math.random()*e.length),a=e[t];return e=e.filter((function(e){return e!==a})),a},reset:function(){e=d}}}(),p=a(10),y=a.n(p),h=function(e){var t=Object(n.useState)(""),a=Object(i.a)(t,2),l=a[0],c=a[1];return r.a.createElement("section",null,r.a.createElement("fieldset",null,r.a.createElement("legend",null,"Add players"),r.a.createElement("form",{className:y.a.addnew,onSubmit:function(t){t.preventDefault(),c(""),e.dispatch({type:"players/add",payload:{name:l,id:Math.random().toString(36).slice(-5),avatar:m.get()}})}},r.a.createElement("input",{onChange:function(e){var t=e.target.value;t&&c(t)},value:l,name:"name",type:"text",placeholder:"Write name"}),r.a.createElement("button",null,"Add"))),r.a.createElement("section",null,r.a.createElement(u,{players:e.players})),r.a.createElement("br",null),r.a.createElement("section",null,r.a.createElement("button",{onClick:function(){e.dispatch({type:"game/start"})}},"Start")))},f=a(5),g=a.n(f),E=null,k={player:null,token:E,play:function(){return null},pause:function(){return null},resume:function(){return null},isPlaying:!1,setIsPlayingListener:function(e){k.isPlayingListener=e},isPlayingListener:null,hasPickedTrack:!1,togglePickedTrack:function(){k.hasPickedTrack=!k.hasPickedTrack}};window.onSpotifyWebPlaybackSDKReady=function(){var e=window.Spotify;window.location.hash&&"#"===window.location.hash[0]&&window.location.hash.slice(1).split("&").forEach((function(e){e.includes("access_token")&&(E=e.split("=")[1])}));var t=new e.Player({name:"Web Playback SDK Quick Start Player",getOAuthToken:function(e){E&&e(E)}});return k.player=t,k.token=E,k.play=function(e){!function(e){var t=e.spotify_uri,a=e.playerInstance._options,n=a.getOAuthToken,r=a.id,l=e.playCallback;n((function(e){fetch("https://api.spotify.com/v1/me/player/play?device_id=".concat(r),{method:"PUT",body:JSON.stringify({uris:[t]}),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){console.log("playing"),l()}))}))}({playerInstance:t,spotify_uri:"spotify:track:".concat(e),playCallback:function(){}})},k.pause=function(){t.pause().then((function(){}))},k.resume=function(){t.resume().then((function(){}))},t.addListener("initialization_error",(function(e){var t=e.message;console.error(t)})),t.addListener("authentication_error",(function(e){var t=e.message;console.error(t)})),t.addListener("account_error",(function(e){var t=e.message;console.error(t)})),t.addListener("playback_error",(function(e){var t=e.message;console.error(t)})),t.addListener("player_state_changed",(function(e){console.log(e),null!=k.isPlayingListener&&k.isPlayingListener(!e.paused,"".concat(e.track_window.current_track.artists[0].name," - ").concat(e.track_window.current_track.name))})),t.addListener("ready",(function(e){var t=e.device_id;console.log(t)})),t.connect(),{player:t}};var b=k,v={searchTerm:"",playlists:[],artists:[],tracks:[],view:"search",playlistResults:null,artistResults:null,isDirty:!1},w=function(e,t){return Object(o.a)(e,(function(e){switch(t.type){case"search/set":e.searchTerm=t.payload;break;case"search/results":e.playlists=t.payload.playlists,e.artists=t.payload.artists,e.tracks=t.payload.tracks,e.isDirty=!0;break;case"playlist/set":e.playlistResults=t.payload,e.view="playlist";break;case"view/reset":e.view="search",e.playlistResults=null}}))},P=function(e){var t;return r.a.createElement("div",{style:{maxHeight:"300px",overflow:"auto"}},r.a.createElement("table",null,r.a.createElement("tbody",null,null===(t=e.tracks)||void 0===t?void 0:t.map((function(t,a){return r.a.createElement("tr",{key:t.id,onClick:function(){b.play(t.id),e.handlePick()}},r.a.createElement("td",null,r.a.createElement("strong",null,t.artists.map((function(e,t){return 0===t?r.a.createElement("span",{key:t},e.name):r.a.createElement("span",{key:t},", ",e.name)})))," ","- ",t.name))})))))},I=function(e){var t,a,l=Object(n.useReducer)(w,v),c=Object(i.a)(l,2),o=c[0],s=c[1];return r.a.createElement("section",null,"playlist"===o.view&&r.a.createElement("section",null,r.a.createElement("div",{onClick:function(){s({type:"view/reset"})}},"\u2190 ",null===(t=o.playlistResults)||void 0===t?void 0:t.name),r.a.createElement("br",null),r.a.createElement(P,{tracks:null===(a=o.playlistResults)||void 0===a?void 0:a.tracks,handlePick:e.handlePick})),"search"===o.view&&r.a.createElement("form",{style:{display:"flex"},onSubmit:function(e){e.preventDefault(),null!=b.token&&fetch("https://api.spotify.com/v1/search?q=".concat(encodeURIComponent(o.searchTerm),"&type=album,track,playlist,artist&limit=10"),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(b.token)}}).then((function(e){return e.json()})).then((function(e){var t=e;s({type:"search/results",payload:{playlists:t.playlists.items.splice(0,10).map((function(e){return{id:e.id,name:e.name}})),artists:t.artists.items.splice(0,3).map((function(e){return{id:e.id,name:e.name}})),tracks:t.tracks.items.map((function(e){return{id:e.id,name:e.name,artists:e.artists.map((function(e){return{name:e.name,id:e.id}}))}}))}})})).catch((function(e){console.error(e)}))}},r.a.createElement("input",{style:{width:"100%"},size:10,value:o.searchTerm,onChange:function(e){null!=e.target&&s({type:"search/set",payload:e.target.value})}}),r.a.createElement("button",null,"Search")),"search"===o.view&&o.isDirty&&r.a.createElement("section",null,r.a.createElement("div",null,r.a.createElement("h3",null,"Tracks:"),r.a.createElement(P,{tracks:o.tracks,handlePick:e.handlePick}),0===o.tracks.length&&"No tracks"),r.a.createElement("div",null,r.a.createElement("h3",null,"Playlists:"),r.a.createElement("table",null,r.a.createElement("tbody",null,o.playlists.map((function(e,t){return r.a.createElement("tr",{onClick:function(){fetch("https://api.spotify.com/v1/playlists/".concat(e.id),{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(b.token)}}).then((function(e){return e.json()})).then((function(e){var t=e;s({type:"playlist/set",payload:{name:t.name,tracks:t.tracks.items.map((function(e){return{id:e.track.id,name:e.track.name,artists:e.track.artists.map((function(e){return{name:e.name,id:e.id}}))}}))}})}))},key:t},r.a.createElement("td",null,e.name," \u2192"))})))),0===o.playlists.length&&"No playlists")))},_=function(e){return r.a.createElement("section",null,r.a.createElement(I,{handlePick:e.handlePick}))},S={cards:[],deck:[],stage:"waiting",currentPlayerId:null,currentCardId:null,hasPicked:!1,rounds:3,round:1},j=function(e,t){var a=t.findIndex((function(t){return t.id===e}));return a+1===t.length?t[0].id:t[a+1].id},O=function(e,t){return Object(o.a)(e,(function(a){switch(t.type){case"inplay/init":a.cards=t.payload.cards,a.deck=Object(s.a)(t.payload.cards).sort((function(){return Math.random()-.5})).map((function(e){return e.id})),a.currentPlayerId=t.payload.defaultPlayerId;break;case"inplay/draw":e.deck.length>0?(a.stage="picking",a.currentCardId=e.deck[0],a.deck=a.deck.filter((function(e,t){return 0!==t}))):a.stage="empty";break;case"inplay/endturn":a.stage="waiting",a.currentPlayerId=t.payload.nextPlayerId,a.currentCardId=null,a.hasPicked=!1,t.payload.isEndOfRound&&(a.round===e.rounds?a.stage="ended":a.round+=1),0===e.deck.length&&(a.stage="empty");break;case"inplay/scoring":a.stage="scoring";break;case"inplay/skip":if(e.deck.length>1){var n=a.deck.shift();null!=n&&(a.deck.push(n),a.currentCardId=a.deck[0])}break;case"inplay/pickedsong":a.hasPicked=!0}}))},C=function(e){var t=Object(n.useReducer)(O,S),a=Object(i.a)(t,2),l=a[0],c=a[1],o=e.players[0].id;Object(n.useEffect)((function(){fetch("https://spreadsheets.google.com/feeds/cells/1KwGMfgab2Mq0Zy8grS6fQLp8fqu9Qoikwb8qWg7OWqc/1/public/full?alt=json").then((function(e){return e.json()})).then((function(e){var t=e.feed.entry.reduce((function(e,t){var a=t.gs$cell;return 1===parseInt(a.col,10)&&parseInt(a.row,10)>1?e.push({prompt:a.$t,id:a.row}):2===parseInt(a.col,10)&&parseInt(a.row,10)>1&&(e[parseInt(a.row,10)-2].category=a.$t),e}),[]);c({type:"inplay/init",payload:{cards:t,defaultPlayerId:o}})}))}),[o]);var d=e.players.find((function(e){return e.id===l.currentPlayerId})),m=l.cards.find((function(e){return e.id===l.currentCardId}));return r.a.createElement("section",{style:{flex:"1 0 auto"}},r.a.createElement("div",null,"Round: ",l.round,"/",l.rounds),r.a.createElement("br",null),"waiting"===l.stage&&r.a.createElement("div",null,r.a.createElement(u,{players:e.players}),r.a.createElement("p",null,"Pass the phone to"," ",d?"".concat(d.avatar," ").concat(d.name):"".concat(e.players[0].avatar," ").concat(e.players[0].name)),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){c({type:"inplay/draw"})}},"Ready")),"empty"===l.stage&&r.a.createElement("div",null,r.a.createElement("p",null,"You have used all the cards"),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){e.appDispatch({type:"game/end"})}},"Finish")),"ended"===l.stage&&r.a.createElement("div",null,r.a.createElement("p",null,"You have finished the game. Click to reveal the scores!"),r.a.createElement("br",null),r.a.createElement("button",{onClick:function(){e.appDispatch({type:"game/end"})}},"Finish")),"picking"===l.stage&&r.a.createElement("div",null,r.a.createElement("p",{className:g.a.prompt},"Play a song that fits the theme: ",r.a.createElement("strong",null,null===m||void 0===m?void 0:m.prompt)),r.a.createElement(_,{handlePick:function(){c({type:"inplay/pickedsong"})}}),null!=(null===m||void 0===m?void 0:m.category)&&r.a.createElement("p",null,"(Hint: ",m.category,")"),r.a.createElement("br",null),l.deck.length>1&&r.a.createElement("button",{onClick:function(){c({type:"inplay/skip"})}},"Skip card"),r.a.createElement("button",{disabled:!l.hasPicked,onClick:function(){c({type:"inplay/scoring"})}},"Done")),"scoring"===l.stage&&r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"Enter who got the correct answers"),r.a.createElement("form",{onSubmit:function(t){t.preventDefault();var a=t.target,n=new FormData(a),r=Object(s.a)(n).reduce((function(e,t){var a=Object(i.a)(t,2)[1];return"null"===a||(a in e?++e[a]:e[a]=1),e}),{});e.appDispatch({type:"game/scores",payload:r}),null!=l.currentPlayerId&&c({type:"inplay/endturn",payload:{nextPlayerId:j(l.currentPlayerId,e.players),isEndOfRound:e.players.findIndex((function(e){return e.id===l.currentPlayerId}))===e.players.length-1}})}},r.a.createElement("label",{className:g.a.choice,htmlFor:"name"},"Artist:"," ",r.a.createElement("select",{name:"artist"},r.a.createElement("option",{value:"null"},"-"),e.players.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.avatar," ",e.name)})))),r.a.createElement("label",{className:g.a.choice,htmlFor:"song"},"Song:"," ",r.a.createElement("select",{name:"song"},r.a.createElement("option",{value:"null"},"-"),e.players.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.avatar," ",e.name)})))),r.a.createElement("label",{className:g.a.choice,htmlFor:"category"},"Prompt:"," ",r.a.createElement("select",{name:"category"},r.a.createElement("option",{value:"null"},"-"),e.players.map((function(e,t){return r.a.createElement("option",{key:t,value:e.id},e.avatar," ",e.name)})))),r.a.createElement("br",null),r.a.createElement("button",null,"Done"))))},R=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),a=t[0],l=t[1],c=Object(n.useState)(""),o=Object(i.a)(c,2),s=o[0],u=o[1];return Object(n.useEffect)((function(){null!=b.setIsPlayingListener&&b.setIsPlayingListener((function(e,t){l(e),u(null!==t&&void 0!==t?t:"")}))}),[]),r.a.createElement("section",null,s," ",a?r.a.createElement("button",{onClick:function(){b.pause()}},"\u23f8"):r.a.createElement("button",{onClick:function(){b.resume()}},"\u25b6"))},D=a(7),L=a.n(D),T=localStorage.getItem("currentgame"),x=null!=T?JSON.parse(T):{gameState:"start",players:[]},A=function(e,t){var a=Object(o.a)(e,(function(e){switch(t.type){case"players/add":e.players.push({name:t.payload.name,score:0,id:t.payload.id,avatar:t.payload.avatar});break;case"game/start":e.gameState="inplay";break;case"game/scores":e.players.forEach((function(e){e.id in t.payload&&(e.score+=t.payload[e.id])}));break;case"game/end":e.gameState="finished";break;case"game/restart":return t.payload}}));return localStorage.setItem("currentgame",JSON.stringify(a)),a};var N=function(){var e=Object(n.useReducer)(A,x),t=Object(i.a)(e,2),a=t[0],l=t[1],c=Object(n.useState)(b.token),o=Object(i.a)(c,2),s=o[0],d=o[1];return r.a.createElement("div",null,r.a.createElement("section",{style:{minHeight:"100vh"}},r.a.createElement("section",{className:L.a.header},r.a.createElement("h1",null,"Pass the AUX"),r.a.createElement("div",{className:L.a.toolbar},r.a.createElement(R,null))),r.a.createElement("hr",null),"start"===a.gameState&&r.a.createElement(h,{players:a.players,dispatch:l}),"inplay"===a.gameState&&r.a.createElement(C,{players:a.players,appDispatch:l}),"finished"===a.gameState&&r.a.createElement("section",null,r.a.createElement(u,{players:a.players}),r.a.createElement("button",{onClick:function(){m.reset(),localStorage.clear(),l({type:"game/restart",payload:{gameState:"start",players:[]}})}},"Restart"))),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("details",null,r.a.createElement("summary",null,"Debug"),r.a.createElement("pre",null,r.a.createElement("code",null,"Debug:",null!=b.token?"Logged in":"Logged out",r.a.createElement("br",null),"token: ",s,r.a.createElement("br",null),r.a.createElement("a",{href:"https://accounts.spotify.com/authorize?client_id=5280f2bd9b014405839ea087c05c58d1&response_type=token&redirect_uri=".concat(encodeURIComponent("localhost:3000"===window.location.host?"http://localhost:3000/callback":"https://atomcorp.github.io/hangthedj/"),"&scope=").concat(encodeURIComponent("streaming user-read-email user-read-private user-modify-playback-state")),target:"_blank",rel:"noopener noreferrer"},"Authenticate"),r.a.createElement("br",null),r.a.createElement("button",{type:"button",onClick:function(){b.token!==s&&d(b.token)}},"Re-auth"),"start"!==a.gameState&&"finished"!==a.gameState&&r.a.createElement("button",{onClick:function(){l({type:"game/end"})}},"Finish")))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(N,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[11,1,2]]]);
//# sourceMappingURL=main.bd4a8ac8.chunk.js.map